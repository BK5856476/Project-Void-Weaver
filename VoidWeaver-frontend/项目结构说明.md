# VoidWeaver 前端项目结构说明

> 本文档详细说明了 VoidWeaver-frontend 项目中每个文件夹和文件的作用

## 📁 根目录文件

### 配置文件

#### `package.json`
- **作用**：项目依赖管理和脚本配置
- **包含内容**：
  - 项目名称和版本信息
  - 所有 npm 依赖包（React、TypeScript、Vite、Tailwind CSS、Zustand、Axios 等）
  - 开发脚本（`dev`、`build`、`preview`）

#### `vite.config.ts`
- **作用**：Vite 构建工具配置
- **功能**：
  - 配置 React 插件
  - 设置路径别名（`@` 指向 `./src`）
  - 配置开发服务器端口（5173）

#### `tsconfig.json`
- **作用**：TypeScript 编译器配置
- **功能**：
  - 启用严格模式（禁止 `any` 类型）
  - 配置 JSX 支持
  - 设置路径别名映射

#### `tsconfig.node.json`
- **作用**：Vite 配置文件的 TypeScript 配置
- **功能**：专门用于编译 `vite.config.ts`

#### `tailwind.config.js`
- **作用**：Tailwind CSS 样式框架配置
- **功能**：
  - 定义自定义颜色（Void Weaver 深色主题）
    - `void-bg`: `#09090b`（背景色）
    - `neon-cyan`: `#06b6d4`（霓虹青）
    - `neon-purple`: `#a855f7`（魔力紫）
  - 配置动画效果（发光脉冲动画）
  - 设置渐变背景

#### `postcss.config.js`
- **作用**：PostCSS 配置（CSS 处理器）
- **功能**：集成 Tailwind CSS 和 Autoprefixer

#### `.gitignore`
- **作用**：Git 版本控制忽略文件列表
- **包含**：`node_modules`、`dist`、`.env` 等

#### `.env.example`
- **作用**：环境变量模板文件
- **包含**：`VITE_API_URL`（后端 API 地址）

---

### HTML 入口

#### `index.html`
- **作用**：应用的 HTML 入口文件
- **功能**：
  - 设置页面标题和 meta 标签
  - 引入 React 应用的挂载点（`<div id="root">`）
  - 加载 `main.tsx` 脚本

---

## 📂 `src/` 源代码目录

### 主文件

#### `main.tsx`
- **作用**：React 应用的 JavaScript 入口文件
- **功能**：
  - 创建 React 根节点
  - 渲染 `App` 组件
  - 引入全局样式（`index.css`）

#### `App.tsx`
- **作用**：应用的根组件
- **功能**：
  - 组合 `Sidebar` 和 `MainWorkspace` 组件
  - 设置全局布局和样式

#### `index.css`
- **作用**：全局 CSS 样式文件
- **功能**：
  - 引入 Tailwind CSS 指令
  - 定义自定义滚动条样式
  - 设置深色主题的全局样式

---

## 📂 `src/api/` - API 接口层

### `client.ts`
- **作用**：封装所有后端 API 调用
- **功能**：
  - 配置 Axios 实例（baseURL、超时时间）
  - 提供三个主要 API 方法：
    - `analyzeImage()` - 调用 Gemini 分析图片
    - `generateImage()` - 调用 NovelAI/Google Imagen 生成图片
    - `refineModules()` - 精炼提示词模块
  - 所有方法都有完整的 TypeScript 类型定义

---

## 📂 `src/types/` - 类型定义

### `index.ts`
- **作用**：集中管理所有 TypeScript 类型定义
- **包含类型**：
  - `TagDto` - 标签对象（文本、权重、ID）
  - `ModuleDto` - 模块对象（7个维度之一）
  - `ModuleType` - 模块类型枚举（style、subject、pose 等）
  - `EngineType` - 引擎类型（novelai、google-imagen）
  - `AnalyzeRequest/Response` - 分析接口的请求/响应
  - `GenerateRequest/Response` - 生成接口的请求/响应
  - `RefineRequest/Response` - 精炼接口的请求/响应
  - `VoidWeaverState` - Zustand 全局状态类型

---

## 📂 `src/store/` - 状态管理

### `useVoidWeaverStore.ts`
- **作用**：Zustand 全局状态管理
- **管理的状态**：
  - **API Keys**：Gemini、NovelAI、Google 凭证
  - **引擎设置**：引擎类型、分辨率、步数、相关性
  - **图片数据**：源图片、生成图片
  - **模块数据**：7个模块的标签数据、原始提示词
  - **UI 状态**：加载状态、当前视图、侧边栏开关
- **提供的方法**：
  - 所有状态的 setter 方法
  - 模块和标签的 CRUD 操作（增删改查）
  - UI 交互方法（切换视图、开关侧边栏）

---

## 📂 `src/lib/` - 工具函数

### `utils.ts`
- **作用**：通用工具函数库
- **包含函数**：
  - `cn()` - Tailwind 类名合并工具（处理条件样式）
  - `generateId()` - 生成唯一 ID
  - `formatWeight()` - 格式化权重显示（如 `×1.05`）
  - `fileToBase64()` - 将图片文件转换为 Base64 字符串
  - `downloadImage()` - 下载 Base64 图片为文件

---

## 📂 `src/components/` - React 组件

### 📂 `components/layout/` - 布局组件

#### `Sidebar.tsx`
- **作用**：左侧设置面板
- **功能**：
  - 品牌标识（VOID WEAVER）
  - 引擎选择器（NovelAI / Imagen）
  - 分辨率下拉菜单
  - 步数滑块（1-50）
  - 系统配置按钮
- **状态**：连接到 Zustand store

#### `MainWorkspace.tsx`
- **作用**：主工作区容器
- **功能**：
  - 左右分屏布局
  - 组合 `VisualCortex` 和 `CodexGrimoire`

---

### 📂 `components/visual/` - 视觉区组件（左侧面板）

#### `VisualCortex.tsx`
- **作用**：左侧图片查看区域的主容器
- **功能**：
  - 网格背景图案
  - 顶部工具栏（ViewToggle + 最大化按钮）
  - 内容区域（根据 currentView 显示不同内容）

#### `ViewToggle.tsx`
- **作用**：Source Reality / New World 切换按钮
- **功能**：
  - 切换查看源图片或生成图片
  - 带图标的分段按钮组
  - 高亮显示当前选中状态

#### `ImageUploadZone.tsx`
- **作用**：图片上传区域
- **功能**：
  - 拖拽上传图片
  - 点击选择文件
  - 显示上传的图片预览
  - 移除图片按钮
  - 支持 PNG、JPG、WEBP 格式

---

### 📂 `components/editor/` - 编辑器组件（右侧面板）

#### `CodexGrimoire.tsx`
- **作用**：右侧提示词编辑器的主容器
- **功能**：
  - 组合工具栏、模块网格、精炼输入框
  - 处理 Decipher、Manifest、Refine 操作
  - 目前模块网格部分是占位符（待开发）

#### `GrimoireToolbar.tsx`
- **作用**：顶部操作工具栏
- **功能**：
  - 显示 "Codex Grimoire // v2.4" 标题
  - **Decipher 按钮**：触发图片分析（带魔杖图标）
  - **MANIFEST 按钮**：触发图片生成（带闪电图标，紫色发光）
  - 加载状态显示（Analyzing... / GENERATING...）

#### `RefinementInput.tsx`
- **作用**：底部自然语言输入框
- **功能**：
  - 输入自然语言指令（如 "Make the lighting more dramatic"）
  - 带紫色星星图标
  - 回车提交
  - 禁用状态（精炼中）

---

## 🎯 组件层级结构

```
App
├── Sidebar
│   ├── 品牌标识
│   ├── 引擎选择器
│   ├── 分辨率选择
│   ├── 步数滑块
│   └── 配置按钮
│
└── MainWorkspace
    ├── VisualCortex（左侧）
    │   ├── ViewToggle
    │   └── ImageUploadZone
    │
    └── CodexGrimoire（右侧）
        ├── GrimoireToolbar
        ├── ModuleGrid（待开发）
        └── RefinementInput
```

---

## 📊 数据流

1. **用户上传图片** → `ImageUploadZone` → Zustand store (`sourceImage`)
2. **点击 Decipher** → `GrimoireToolbar` → API 调用 → 更新 `modules`
3. **编辑标签** → ModuleCard（待开发）→ Zustand store
4. **点击 MANIFEST** → `GrimoireToolbar` → API 调用 → 更新 `generatedImage`
5. **输入精炼指令** → `RefinementInput` → API 调用 → 更新 `modules`

---

## 🎨 样式系统

- **Tailwind CSS**：所有组件使用 Tailwind 类名
- **自定义颜色**：在 `tailwind.config.js` 中定义
- **自定义样式**：在 `index.css` 中定义（滚动条、发光效果）
- **响应式**：所有组件支持深色主题

---

## ⏭️ 待开发组件

- `ModuleGrid.tsx` - 7个模块的网格容器
- `ModuleCard.tsx` - 单个模块卡片
- `MagicTag.tsx` - 可交互的标签组件（核心功能）

---

**更新时间**：2026-01-23  
**版本**：v1.0
